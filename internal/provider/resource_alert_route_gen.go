// DO NOT MODIFY: This file is generated by internal/providergen/index.ts. Any changes will be overwritten during the next build.
package provider

import (
	"context"

	"github.com/hashicorp/terraform-plugin-framework/path"
	"github.com/hashicorp/terraform-plugin-framework/resource"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema"
	"github.com/hashicorp/terraform-plugin-framework/types"
	supertypes "github.com/orange-cloudavenue/terraform-plugin-framework-supertypes"
	"github.com/rootlyhq/terraform-provider-rootly/v2/internal/apiclient"
)

var _ resource.Resource = (*AlertRouteResource)(nil)
var _ resource.ResourceWithImportState = (*AlertRouteResource)(nil)

func NewAlertRouteResource() resource.Resource {
	return &AlertRouteResource{}
}

type AlertRouteResource struct {
	baseResource
	extendableResource[AlertRouteModel]
}

func (r *AlertRouteResource) Metadata(ctx context.Context, req resource.MetadataRequest, resp *resource.MetadataResponse) {
	resp.TypeName = req.ProviderTypeName + "_alert_route"
}

func (r *AlertRouteResource) Schema(ctx context.Context, req resource.SchemaRequest, resp *resource.SchemaResponse) {
	resp.Schema =
		schema.Schema{
			Attributes: map[string]schema.Attribute{
				"id": schema.StringAttribute{

					Computed:            true,
					Description:         "The ID of the alert route",
					MarkdownDescription: "The ID of the alert route",
				},
				"name": schema.StringAttribute{

					Required: true,

					Description:         "The name of the alert route",
					MarkdownDescription: "The name of the alert route",
				},
				"enabled": schema.BoolAttribute{

					Optional: true,

					Description:         "Whether the alert route is enabled",
					MarkdownDescription: "Whether the alert route is enabled",
				},
				"alerts_source_ids": schema.ListAttribute{

					Required: true,

					CustomType: supertypes.NewListTypeOf[string](ctx),
				},
				"owning_team_ids": schema.ListAttribute{

					Optional: true,

					CustomType: supertypes.NewListTypeOf[string](ctx),
				},
				"rules": schema.ListNestedAttribute{

					Optional: true,

					CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItem](ctx),
					NestedObject: schema.NestedAttributeObject{
						Attributes: map[string]schema.Attribute{
							"name": schema.StringAttribute{

								Required: true,

								Description:         "The name of the alert routing rule",
								MarkdownDescription: "The name of the alert routing rule",
							},
							"position": schema.Int64Attribute{

								Optional: true,

								Description:         "The position of the alert routing rule for ordering evaluation",
								MarkdownDescription: "The position of the alert routing rule for ordering evaluation",
							},
							"fallback_rule": schema.BoolAttribute{

								Optional: true,

								Description:         "Whether this is a fallback rule",
								MarkdownDescription: "Whether this is a fallback rule",
							},
							"destinations": schema.ListNestedAttribute{

								Required: true,

								CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItemDestinationsItem](ctx),
								NestedObject: schema.NestedAttributeObject{
									Attributes: map[string]schema.Attribute{
										"target_type": schema.StringAttribute{

											Required: true,

											Description:         "The type of the target",
											MarkdownDescription: "The type of the target",
										},
										"target_id": schema.StringAttribute{

											Required: true,

											Description:         "The ID of the target",
											MarkdownDescription: "The ID of the target",
										},
									},
								},
							},
							"condition_groups": schema.ListNestedAttribute{

								Required: true,

								CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItemConditionGroupsItem](ctx),
								NestedObject: schema.NestedAttributeObject{
									Attributes: map[string]schema.Attribute{
										"position": schema.Int64Attribute{

											Optional: true,

											Description:         "The position of the condition group",
											MarkdownDescription: "The position of the condition group",
										},
										"conditions": schema.ListNestedAttribute{

											Required: true,

											CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItemConditionGroupsItemConditionsItem](ctx),
											NestedObject: schema.NestedAttributeObject{
												Attributes: map[string]schema.Attribute{
													"property_field_condition_type": schema.StringAttribute{

														Required: true,
													},
													"property_field_name": schema.StringAttribute{

														Optional: true,

														Description:         "The name of the property field",
														MarkdownDescription: "The name of the property field",
													},
													"property_field_type": schema.StringAttribute{

														Required: true,
													},
													"property_field_value": schema.StringAttribute{

														Optional: true,

														Description:         "The value of the property field",
														MarkdownDescription: "The value of the property field",
													},
													"property_field_values": schema.ListAttribute{

														Optional: true,

														CustomType: supertypes.NewListTypeOf[string](ctx),
													},
													"alert_urgency_ids": schema.ListAttribute{

														Optional: true,

														Description:         "The Alert Urgency IDs to check in the condition",
														MarkdownDescription: "The Alert Urgency IDs to check in the condition",

														CustomType: supertypes.NewListTypeOf[string](ctx),
													},
													"conditionable_type": schema.StringAttribute{

														Optional: true,

														Description:         "The type of the conditionable",
														MarkdownDescription: "The type of the conditionable",
													},
													"conditionable_id": schema.StringAttribute{

														Optional: true,

														Description:         "The ID of the conditionable",
														MarkdownDescription: "The ID of the conditionable",
													},
												},
											},
										},
									},
								},
							},
						},
					},
				},
			},
		}
}

func (r *AlertRouteResource) Create(ctx context.Context, req resource.CreateRequest, resp *resource.CreateResponse) {
	var data AlertRouteModel

	// Read Terraform plan data into the model
	resp.Diagnostics.Append(req.Plan.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Create API call logic
	r.create(ctx, &data, resp)

	if resp.Diagnostics.HasError() {
		return
	}

	// Save data into Terraform state
	resp.Diagnostics.Append(resp.State.Set(ctx, &data)...)
}

func (r *AlertRouteResource) Read(ctx context.Context, req resource.ReadRequest, resp *resource.ReadResponse) {
	var data AlertRouteModel

	// Read Terraform prior state data into the model
	resp.Diagnostics.Append(req.State.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Read API call logic
	r.read(ctx, &data, resp)

	if resp.Diagnostics.HasError() {
		return
	}

	// Save updated data into Terraform state
	resp.Diagnostics.Append(resp.State.Set(ctx, &data)...)
}

func (r *AlertRouteResource) Update(ctx context.Context, req resource.UpdateRequest, resp *resource.UpdateResponse) {
	var plan, data AlertRouteModel

	// Read Terraform plan data into the model
	resp.Diagnostics.Append(req.Plan.Get(ctx, &plan)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Read Terraform state data into the model
	resp.Diagnostics.Append(req.State.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Update API call logic
	r.update(ctx, plan, &data, resp)

	if resp.Diagnostics.HasError() {
		return
	}

	// Save updated data into Terraform state
	resp.Diagnostics.Append(resp.State.Set(ctx, &data)...)
}

func (r *AlertRouteResource) Delete(ctx context.Context, req resource.DeleteRequest, resp *resource.DeleteResponse) {
	var data AlertRouteModel

	// Read Terraform prior state data into the model
	resp.Diagnostics.Append(req.State.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Delete API call logic
	r.delete(ctx, &data, resp)
}

func (r *AlertRouteResource) ImportState(ctx context.Context, req resource.ImportStateRequest, resp *resource.ImportStateResponse) {
	resource.ImportStatePassthroughID(ctx, path.Root("id"), req, resp)
}

type AlertRouteModel struct {
	Id              types.String                                                 `tfsdk:"id"`
	Name            types.String                                                 `tfsdk:"name"`
	Enabled         types.Bool                                                   `tfsdk:"enabled"`
	AlertsSourceIds supertypes.ListValueOf[string]                               `tfsdk:"alerts_source_ids"`
	OwningTeamIds   supertypes.ListValueOf[string]                               `tfsdk:"owning_team_ids"`
	Rules           supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItem] `tfsdk:"rules"`
}

func (m *AlertRouteModel) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModel, error) {
	var out apiclient.AlertRouteModel

	if !m.Name.IsNull() {
		out.Name = m.Name.ValueString()
	}

	if !m.Enabled.IsNull() {
		out.Enabled = m.Enabled.ValueBool()
	}

	// TODO
	// TODO
	// TODO
	return &out, nil
}

type AlertRouteModelRulesItem struct {
	Name            types.String                                                                    `tfsdk:"name"`
	Position        types.Int64                                                                     `tfsdk:"position"`
	FallbackRule    types.Bool                                                                      `tfsdk:"fallback_rule"`
	Destinations    supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItemDestinationsItem]    `tfsdk:"destinations"`
	ConditionGroups supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItemConditionGroupsItem] `tfsdk:"condition_groups"`
}

func (m *AlertRouteModelRulesItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItem, error) {
	var out apiclient.AlertRouteModelRulesItem

	if !m.Name.IsNull() {
		out.Name = m.Name.ValueString()
	}

	if !m.Position.IsNull() {
		out.Position = m.Position.ValueInt64()
	}

	if !m.FallbackRule.IsNull() {
		out.FallbackRule = m.FallbackRule.ValueBool()
	}

	// TODO
	// TODO
	return &out, nil
}

type AlertRouteModelRulesItemDestinationsItem struct {
	TargetType types.String `tfsdk:"target_type"`
	TargetId   types.String `tfsdk:"target_id"`
}

func (m *AlertRouteModelRulesItemDestinationsItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItemDestinationsItem, error) {
	var out apiclient.AlertRouteModelRulesItemDestinationsItem

	if !m.TargetType.IsNull() {
		out.TargetType = m.TargetType.ValueString()
	}

	if !m.TargetId.IsNull() {
		out.TargetId = m.TargetId.ValueString()
	}

	return &out, nil
}

type AlertRouteModelRulesItemConditionGroupsItem struct {
	Position   types.Int64                                                                                   `tfsdk:"position"`
	Conditions supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItemConditionGroupsItemConditionsItem] `tfsdk:"conditions"`
}

func (m *AlertRouteModelRulesItemConditionGroupsItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItemConditionGroupsItem, error) {
	var out apiclient.AlertRouteModelRulesItemConditionGroupsItem

	if !m.Position.IsNull() {
		out.Position = m.Position.ValueInt64()
	}

	// TODO
	return &out, nil
}

type AlertRouteModelRulesItemConditionGroupsItemConditionsItem struct {
	PropertyFieldConditionType types.String                   `tfsdk:"property_field_condition_type"`
	PropertyFieldName          types.String                   `tfsdk:"property_field_name"`
	PropertyFieldType          types.String                   `tfsdk:"property_field_type"`
	PropertyFieldValue         types.String                   `tfsdk:"property_field_value"`
	PropertyFieldValues        supertypes.ListValueOf[string] `tfsdk:"property_field_values"`
	AlertUrgencyIds            supertypes.ListValueOf[string] `tfsdk:"alert_urgency_ids"`
	ConditionableType          types.String                   `tfsdk:"conditionable_type"`
	ConditionableId            types.String                   `tfsdk:"conditionable_id"`
}

func (m *AlertRouteModelRulesItemConditionGroupsItemConditionsItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItemConditionGroupsItemConditionsItem, error) {
	var out apiclient.AlertRouteModelRulesItemConditionGroupsItemConditionsItem

	if !m.PropertyFieldConditionType.IsNull() {
		out.PropertyFieldConditionType = m.PropertyFieldConditionType.ValueString()
	}

	if !m.PropertyFieldName.IsNull() {
		out.PropertyFieldName = m.PropertyFieldName.ValueString()
	}

	if !m.PropertyFieldType.IsNull() {
		out.PropertyFieldType = m.PropertyFieldType.ValueString()
	}

	if !m.PropertyFieldValue.IsNull() {
		out.PropertyFieldValue = m.PropertyFieldValue.ValueString()
	}

	// TODO
	// TODO

	if !m.ConditionableType.IsNull() {
		out.ConditionableType = m.ConditionableType.ValueString()
	}

	if !m.ConditionableId.IsNull() {
		out.ConditionableId = m.ConditionableId.ValueString()
	}

	return &out, nil
}
