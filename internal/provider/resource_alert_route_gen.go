// DO NOT MODIFY: This file is generated by internal/providergen/index.ts. Any changes will be overwritten during the next build.
package provider

import (
	"context"

	"github.com/hashicorp/terraform-plugin-framework/path"
	"github.com/hashicorp/terraform-plugin-framework/resource"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema"
	supertypes "github.com/orange-cloudavenue/terraform-plugin-framework-supertypes"
	"github.com/rootlyhq/terraform-provider-rootly/v2/internal/apiclient"
)

var _ resource.Resource = (*AlertRouteResource)(nil)
var _ resource.ResourceWithImportState = (*AlertRouteResource)(nil)

func NewAlertRouteResource() resource.Resource {
	return &AlertRouteResource{}
}

type AlertRouteResource struct {
	baseResource
	extendableResource[AlertRouteModel]
}

func (r *AlertRouteResource) Metadata(ctx context.Context, req resource.MetadataRequest, resp *resource.MetadataResponse) {
	resp.TypeName = req.ProviderTypeName + "_alert_route"
}

func (r *AlertRouteResource) Schema(ctx context.Context, req resource.SchemaRequest, resp *resource.SchemaResponse) {
	resp.Schema =
		schema.Schema{
			Attributes: map[string]schema.Attribute{
				"id": schema.StringAttribute{
					Computed:            true,
					Description:         "The ID of the alert route",
					MarkdownDescription: "The ID of the alert route",
					CustomType:          supertypes.StringType{},
				},
				"name": schema.StringAttribute{
					Required:            true,
					Description:         "The name of the alert route",
					MarkdownDescription: "The name of the alert route",
					CustomType:          supertypes.StringType{},
				},
				"enabled": schema.BoolAttribute{
					Optional:            true,
					Description:         "Whether the alert route is enabled",
					MarkdownDescription: "Whether the alert route is enabled",
					CustomType:          supertypes.BoolType{},
				},
				"alerts_source_ids": schema.ListAttribute{
					Required:   true,
					CustomType: supertypes.NewListTypeOf[string](ctx),
				},
				"owning_team_ids": schema.ListAttribute{
					Optional:   true,
					CustomType: supertypes.NewListTypeOf[string](ctx),
				},
				"rules": schema.ListNestedAttribute{
					Optional:   true,
					CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItem](ctx),
					NestedObject: schema.NestedAttributeObject{
						Attributes: map[string]schema.Attribute{
							"name": schema.StringAttribute{
								Required:            true,
								Description:         "The name of the alert routing rule",
								MarkdownDescription: "The name of the alert routing rule",
								CustomType:          supertypes.StringType{},
							},
							"position": schema.Int64Attribute{
								Optional:            true,
								Description:         "The position of the alert routing rule for ordering evaluation",
								MarkdownDescription: "The position of the alert routing rule for ordering evaluation",
								CustomType:          supertypes.Int64Type{},
							},
							"fallback_rule": schema.BoolAttribute{
								Optional:            true,
								Description:         "Whether this is a fallback rule",
								MarkdownDescription: "Whether this is a fallback rule",
								CustomType:          supertypes.BoolType{},
							},
							"destinations": schema.ListNestedAttribute{
								Required:   true,
								CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItemDestinationsItem](ctx),
								NestedObject: schema.NestedAttributeObject{
									Attributes: map[string]schema.Attribute{
										"target_type": schema.StringAttribute{
											Required:            true,
											Description:         "The type of the target",
											MarkdownDescription: "The type of the target",
											CustomType:          supertypes.StringType{},
										},
										"target_id": schema.StringAttribute{
											Required:            true,
											Description:         "The ID of the target",
											MarkdownDescription: "The ID of the target",
											CustomType:          supertypes.StringType{},
										},
									},
								},
							},
							"condition_groups": schema.ListNestedAttribute{
								Required:   true,
								CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItemConditionGroupsItem](ctx),
								NestedObject: schema.NestedAttributeObject{
									Attributes: map[string]schema.Attribute{
										"position": schema.Int64Attribute{
											Optional:            true,
											Description:         "The position of the condition group",
											MarkdownDescription: "The position of the condition group",
											CustomType:          supertypes.Int64Type{},
										},
										"conditions": schema.ListNestedAttribute{
											Required:   true,
											CustomType: supertypes.NewListNestedObjectTypeOf[AlertRouteModelRulesItemConditionGroupsItemConditionsItem](ctx),
											NestedObject: schema.NestedAttributeObject{
												Attributes: map[string]schema.Attribute{
													"property_field_condition_type": schema.StringAttribute{
														Required:   true,
														CustomType: supertypes.StringType{},
													},
													"property_field_name": schema.StringAttribute{
														Optional:            true,
														Description:         "The name of the property field",
														MarkdownDescription: "The name of the property field",
														CustomType:          supertypes.StringType{},
													},
													"property_field_type": schema.StringAttribute{
														Required:   true,
														CustomType: supertypes.StringType{},
													},
													"property_field_value": schema.StringAttribute{
														Optional:            true,
														Description:         "The value of the property field",
														MarkdownDescription: "The value of the property field",
														CustomType:          supertypes.StringType{},
													},
													"property_field_values": schema.ListAttribute{
														Optional:   true,
														CustomType: supertypes.NewListTypeOf[string](ctx),
													},
													"alert_urgency_ids": schema.ListAttribute{
														Optional:            true,
														Description:         "The Alert Urgency IDs to check in the condition",
														MarkdownDescription: "The Alert Urgency IDs to check in the condition",
														CustomType:          supertypes.NewListTypeOf[string](ctx),
													},
													"conditionable_type": schema.StringAttribute{
														Optional:            true,
														Description:         "The type of the conditionable",
														MarkdownDescription: "The type of the conditionable",
														CustomType:          supertypes.StringType{},
													},
													"conditionable_id": schema.StringAttribute{
														Optional:            true,
														Description:         "The ID of the conditionable",
														MarkdownDescription: "The ID of the conditionable",
														CustomType:          supertypes.StringType{},
													},
												},
											},
										},
									},
								},
							},
						},
					},
				},
			},
		}
}

func (r *AlertRouteResource) Create(ctx context.Context, req resource.CreateRequest, resp *resource.CreateResponse) {
	var data AlertRouteModel

	// Read Terraform plan data into the model
	resp.Diagnostics.Append(req.Plan.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Create API call logic
	r.create(ctx, &data, resp)

	if resp.Diagnostics.HasError() {
		return
	}

	// Save data into Terraform state
	resp.Diagnostics.Append(resp.State.Set(ctx, &data)...)
}

func (r *AlertRouteResource) Read(ctx context.Context, req resource.ReadRequest, resp *resource.ReadResponse) {
	var data AlertRouteModel

	// Read Terraform prior state data into the model
	resp.Diagnostics.Append(req.State.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Read API call logic
	r.read(ctx, &data, resp)

	if resp.Diagnostics.HasError() {
		return
	}

	// Save updated data into Terraform state
	resp.Diagnostics.Append(resp.State.Set(ctx, &data)...)
}

func (r *AlertRouteResource) Update(ctx context.Context, req resource.UpdateRequest, resp *resource.UpdateResponse) {
	var plan, data AlertRouteModel

	// Read Terraform plan data into the model
	resp.Diagnostics.Append(req.Plan.Get(ctx, &plan)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Read Terraform state data into the model
	resp.Diagnostics.Append(req.State.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Update API call logic
	r.update(ctx, plan, &data, resp)

	if resp.Diagnostics.HasError() {
		return
	}

	// Save updated data into Terraform state
	resp.Diagnostics.Append(resp.State.Set(ctx, &data)...)
}

func (r *AlertRouteResource) Delete(ctx context.Context, req resource.DeleteRequest, resp *resource.DeleteResponse) {
	var data AlertRouteModel

	// Read Terraform prior state data into the model
	resp.Diagnostics.Append(req.State.Get(ctx, &data)...)

	if resp.Diagnostics.HasError() {
		return
	}

	// Delete API call logic
	r.delete(ctx, &data, resp)
}

func (r *AlertRouteResource) ImportState(ctx context.Context, req resource.ImportStateRequest, resp *resource.ImportStateResponse) {
	resource.ImportStatePassthroughID(ctx, path.Root("id"), req, resp)
}

type AlertRouteModel struct {
	Id              supertypes.StringValue                                       `tfsdk:"id"`
	Name            supertypes.StringValue                                       `tfsdk:"name"`
	Enabled         supertypes.BoolValue                                         `tfsdk:"enabled"`
	AlertsSourceIds supertypes.ListValueOf[string]                               `tfsdk:"alerts_source_ids"`
	OwningTeamIds   supertypes.ListValueOf[string]                               `tfsdk:"owning_team_ids"`
	Rules           supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItem] `tfsdk:"rules"`
}

func (m *AlertRouteModel) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModel, error) {
	var out apiclient.AlertRouteModel

	if !m.Name.IsNull() {
		out.Name = m.Name.ValueString()
	}

	if !m.Enabled.IsNull() {
		out.Enabled = m.Enabled.ValueBool()
	}

	if !m.AlertsSourceIds.IsNull() {
		out.AlertsSourceIds = m.AlertsSourceIds.MustGet(ctx)
	}

	if !m.OwningTeamIds.IsNull() {
		out.OwningTeamIds = m.OwningTeamIds.MustGet(ctx)
	}

	if !m.Rules.IsNull() {
		for _, item := range m.Rules.MustGet(ctx) {
			itemClientModel, err := item.ToClientModel(ctx)
			if err != nil {
				return nil, err
			}
			out.Rules = append(out.Rules, *itemClientModel)
		}
	}

	return &out, nil
}

type AlertRouteModelRulesItem struct {
	Name            supertypes.StringValue                                                          `tfsdk:"name"`
	Position        supertypes.Int64Value                                                           `tfsdk:"position"`
	FallbackRule    supertypes.BoolValue                                                            `tfsdk:"fallback_rule"`
	Destinations    supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItemDestinationsItem]    `tfsdk:"destinations"`
	ConditionGroups supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItemConditionGroupsItem] `tfsdk:"condition_groups"`
}

func (m *AlertRouteModelRulesItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItem, error) {
	var out apiclient.AlertRouteModelRulesItem

	if !m.Name.IsNull() {
		out.Name = m.Name.ValueString()
	}

	if !m.Position.IsNull() {
		out.Position = m.Position.ValueInt64()
	}

	if !m.FallbackRule.IsNull() {
		out.FallbackRule = m.FallbackRule.ValueBool()
	}

	if !m.Destinations.IsNull() {
		for _, item := range m.Destinations.MustGet(ctx) {
			itemClientModel, err := item.ToClientModel(ctx)
			if err != nil {
				return nil, err
			}
			out.Destinations = append(out.Destinations, *itemClientModel)
		}
	}

	if !m.ConditionGroups.IsNull() {
		for _, item := range m.ConditionGroups.MustGet(ctx) {
			itemClientModel, err := item.ToClientModel(ctx)
			if err != nil {
				return nil, err
			}
			out.ConditionGroups = append(out.ConditionGroups, *itemClientModel)
		}
	}

	return &out, nil
}

type AlertRouteModelRulesItemDestinationsItem struct {
	TargetType supertypes.StringValue `tfsdk:"target_type"`
	TargetId   supertypes.StringValue `tfsdk:"target_id"`
}

func (m *AlertRouteModelRulesItemDestinationsItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItemDestinationsItem, error) {
	var out apiclient.AlertRouteModelRulesItemDestinationsItem

	if !m.TargetType.IsNull() {
		out.TargetType = m.TargetType.ValueString()
	}

	if !m.TargetId.IsNull() {
		out.TargetId = m.TargetId.ValueString()
	}

	return &out, nil
}

type AlertRouteModelRulesItemConditionGroupsItem struct {
	Position   supertypes.Int64Value                                                                         `tfsdk:"position"`
	Conditions supertypes.ListNestedObjectValueOf[AlertRouteModelRulesItemConditionGroupsItemConditionsItem] `tfsdk:"conditions"`
}

func (m *AlertRouteModelRulesItemConditionGroupsItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItemConditionGroupsItem, error) {
	var out apiclient.AlertRouteModelRulesItemConditionGroupsItem

	if !m.Position.IsNull() {
		out.Position = m.Position.ValueInt64()
	}

	if !m.Conditions.IsNull() {
		for _, item := range m.Conditions.MustGet(ctx) {
			itemClientModel, err := item.ToClientModel(ctx)
			if err != nil {
				return nil, err
			}
			out.Conditions = append(out.Conditions, *itemClientModel)
		}
	}

	return &out, nil
}

type AlertRouteModelRulesItemConditionGroupsItemConditionsItem struct {
	PropertyFieldConditionType supertypes.StringValue         `tfsdk:"property_field_condition_type"`
	PropertyFieldName          supertypes.StringValue         `tfsdk:"property_field_name"`
	PropertyFieldType          supertypes.StringValue         `tfsdk:"property_field_type"`
	PropertyFieldValue         supertypes.StringValue         `tfsdk:"property_field_value"`
	PropertyFieldValues        supertypes.ListValueOf[string] `tfsdk:"property_field_values"`
	AlertUrgencyIds            supertypes.ListValueOf[string] `tfsdk:"alert_urgency_ids"`
	ConditionableType          supertypes.StringValue         `tfsdk:"conditionable_type"`
	ConditionableId            supertypes.StringValue         `tfsdk:"conditionable_id"`
}

func (m *AlertRouteModelRulesItemConditionGroupsItemConditionsItem) ToClientModel(ctx context.Context) (*apiclient.AlertRouteModelRulesItemConditionGroupsItemConditionsItem, error) {
	var out apiclient.AlertRouteModelRulesItemConditionGroupsItemConditionsItem

	if !m.PropertyFieldConditionType.IsNull() {
		out.PropertyFieldConditionType = m.PropertyFieldConditionType.ValueString()
	}

	if !m.PropertyFieldName.IsNull() {
		out.PropertyFieldName = m.PropertyFieldName.ValueString()
	}

	if !m.PropertyFieldType.IsNull() {
		out.PropertyFieldType = m.PropertyFieldType.ValueString()
	}

	if !m.PropertyFieldValue.IsNull() {
		out.PropertyFieldValue = m.PropertyFieldValue.ValueString()
	}

	if !m.PropertyFieldValues.IsNull() {
		out.PropertyFieldValues = m.PropertyFieldValues.MustGet(ctx)
	}

	if !m.AlertUrgencyIds.IsNull() {
		out.AlertUrgencyIds = m.AlertUrgencyIds.MustGet(ctx)
	}

	if !m.ConditionableType.IsNull() {
		out.ConditionableType = m.ConditionableType.ValueString()
	}

	if !m.ConditionableId.IsNull() {
		out.ConditionableId = m.ConditionableId.ValueString()
	}

	return &out, nil
}

func FillAlertRouteModel(ctx context.Context, in apiclient.AlertRouteModel, out *AlertRouteModel) error {
	out.Id = supertypes.NewStringValueOrNull(in.Id)
	out.Name = supertypes.NewStringValueOrNull(in.Name)
	out.Enabled = supertypes.NewBoolValue(in.Enabled)
	out.AlertsSourceIds = supertypes.NewListValueOfSlice(ctx, in.AlertsSourceIds)
	out.OwningTeamIds = supertypes.NewListValueOfSlice(ctx, in.OwningTeamIds)

	{
		var elements []AlertRouteModelRulesItem
		for _, item := range in.Rules {
			var element AlertRouteModelRulesItem
			err := FillAlertRouteModelRulesItem(ctx, item, &element)
			if err != nil {
				return err
			}
			elements = append(elements, element)
		}
		out.Rules = supertypes.NewListNestedObjectValueOfValueSlice(ctx, elements)
	}

	return nil
}

func FillAlertRouteModelRulesItem(ctx context.Context, in apiclient.AlertRouteModelRulesItem, out *AlertRouteModelRulesItem) error {
	out.Name = supertypes.NewStringValueOrNull(in.Name)
	out.Position = supertypes.NewInt64Value(in.Position)
	out.FallbackRule = supertypes.NewBoolValue(in.FallbackRule)

	{
		var elements []AlertRouteModelRulesItemDestinationsItem
		for _, item := range in.Destinations {
			var element AlertRouteModelRulesItemDestinationsItem
			err := FillAlertRouteModelRulesItemDestinationsItem(ctx, item, &element)
			if err != nil {
				return err
			}
			elements = append(elements, element)
		}
		out.Destinations = supertypes.NewListNestedObjectValueOfValueSlice(ctx, elements)
	}

	{
		var elements []AlertRouteModelRulesItemConditionGroupsItem
		for _, item := range in.ConditionGroups {
			var element AlertRouteModelRulesItemConditionGroupsItem
			err := FillAlertRouteModelRulesItemConditionGroupsItem(ctx, item, &element)
			if err != nil {
				return err
			}
			elements = append(elements, element)
		}
		out.ConditionGroups = supertypes.NewListNestedObjectValueOfValueSlice(ctx, elements)
	}

	return nil
}

func FillAlertRouteModelRulesItemDestinationsItem(ctx context.Context, in apiclient.AlertRouteModelRulesItemDestinationsItem, out *AlertRouteModelRulesItemDestinationsItem) error {
	out.TargetType = supertypes.NewStringValueOrNull(in.TargetType)
	out.TargetId = supertypes.NewStringValueOrNull(in.TargetId)
	return nil
}

func FillAlertRouteModelRulesItemConditionGroupsItem(ctx context.Context, in apiclient.AlertRouteModelRulesItemConditionGroupsItem, out *AlertRouteModelRulesItemConditionGroupsItem) error {
	out.Position = supertypes.NewInt64Value(in.Position)

	{
		var elements []AlertRouteModelRulesItemConditionGroupsItemConditionsItem
		for _, item := range in.Conditions {
			var element AlertRouteModelRulesItemConditionGroupsItemConditionsItem
			err := FillAlertRouteModelRulesItemConditionGroupsItemConditionsItem(ctx, item, &element)
			if err != nil {
				return err
			}
			elements = append(elements, element)
		}
		out.Conditions = supertypes.NewListNestedObjectValueOfValueSlice(ctx, elements)
	}

	return nil
}

func FillAlertRouteModelRulesItemConditionGroupsItemConditionsItem(ctx context.Context, in apiclient.AlertRouteModelRulesItemConditionGroupsItemConditionsItem, out *AlertRouteModelRulesItemConditionGroupsItemConditionsItem) error {
	out.PropertyFieldConditionType = supertypes.NewStringValueOrNull(in.PropertyFieldConditionType)
	out.PropertyFieldName = supertypes.NewStringValueOrNull(in.PropertyFieldName)
	out.PropertyFieldType = supertypes.NewStringValueOrNull(in.PropertyFieldType)
	out.PropertyFieldValue = supertypes.NewStringValueOrNull(in.PropertyFieldValue)
	out.PropertyFieldValues = supertypes.NewListValueOfSlice(ctx, in.PropertyFieldValues)
	out.AlertUrgencyIds = supertypes.NewListValueOfSlice(ctx, in.AlertUrgencyIds)
	out.ConditionableType = supertypes.NewStringValueOrNull(in.ConditionableType)
	out.ConditionableId = supertypes.NewStringValueOrNull(in.ConditionableId)
	return nil
}
